<!DOCTYPE html>
<html lang="ru" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= it.title || 'KvadricepsHub - Платформа волонтёрских мероприятий' %></title>
  <meta name="description" content="<%= it.description || 'Найдите волонтёрские возможности или организуйте мероприятие на KvadricepsHub' %>" />
  
  <!-- OpenGraph tags -->
  <meta property="og:title" content="<%= it.ogTitle || it.title || 'KvadricepsHub' %>" />
  <meta property="og:description" content="<%= it.ogDescription || it.description || 'Платформа для объединения волонтёров и организаций' %>" />
  <meta property="og:image" content="<%= it.ogImage || 'https://kvadricepshub.example.com/og-image.jpg' %>" />
  <meta property="og:url" content="<%= it.ogUrl || 'https://kvadricepshub.example.com' %>" />
  <meta property="og:type" content="<%= it.ogType || 'website' %>" />
  <meta property="og:site_name" content="KvadricepsHub" />
  <meta property="og:locale" content="ru_RU" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="<%= it.ogTitle || it.title || 'KvadricepsHub' %>" />
  <meta name="twitter:description" content="<%= it.ogDescription || it.description || 'Платформа для объединения волонтёров и организаций' %>" />
  <meta name="twitter:image" content="<%= it.ogImage || 'https://kvadricepshub.example.com/og-image.jpg' %>" />
  
  <!-- Canonical URL -->
  <link rel="canonical" href="<%= it.ogUrl || 'https://kvadricepshub.example.com' %>" />
  
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#10b981" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  
  <!-- Styles -->
  <link rel="stylesheet" href="/style.css" />
  
  <!-- Scripts -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://unpkg.com/alpinejs@3.13.0/dist/cdn.min.js" defer></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body class="min-h-full bg-gradient-to-br from-slate-50 to-slate-100 text-slate-900" x-data="{ mobileMenuOpen: false }">
  
  <!-- Navigation -->
  <nav class="bg-white shadow-sm border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        
        <!-- Logo -->
        <div class="flex items-center">
          <a href="/" class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center">
              <i data-lucide="heart-handshake" class="w-5 h-5 text-white"></i>
            </div>
            <span class="text-xl font-bold text-slate-900">KvadricepsHub</span>
          </a>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-8">
          <a href="/events" class="text-slate-600 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium transition-colors">
            События
          </a>
          <a href="/organizations" class="text-slate-600 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium transition-colors">
            Организации
          </a>
          <% if (it.user) { %>
            <div class="relative" x-data="{ open: false }">
              <button @click="open = !open" class="flex items-center space-x-2 text-slate-600 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium">
                <span><%= it.user.name %></span>
                <i data-lucide="chevron-down" class="w-4 h-4"></i>
              </button>
              <div x-show="open" @click.away="open = false" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                <a href="/account" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Личный кабинет</a>
                
                <% if (it.user?.roles?.includes('coordinator')) { %>
                  <div class="border-t border-slate-200"></div>
                  <div class="px-4 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wide">Координатор</div>
                  <a href="/coordinator" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">
                    <i data-lucide="users" class="w-4 h-4 inline mr-2"></i>
                    Панель координатора
                  </a>
                  <a href="/coordinator/events" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">
                    <i data-lucide="calendar-check" class="w-4 h-4 inline mr-2"></i>
                    Мои события
                  </a>
                <% } %>
                
                <% if (it.user?.roles?.includes('organizer')) { %>
                  <div class="border-t border-slate-200"></div>
                  <div class="px-4 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wide">Организатор</div>
                  <a href="/org/dashboard" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">
                    <i data-lucide="building" class="w-4 h-4 inline mr-2"></i>
                    Дашборд организации
                  </a>
                <% } %>
                
                <% if (it.user?.email === 'admin@example.com') { %>
                  <div class="border-t border-slate-200"></div>
                  <div class="px-4 py-2 text-xs font-semibold text-indigo-500 uppercase tracking-wide">Быстрые переходы</div>
                  <a href="/account" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">
                    <i data-lucide="heart" class="w-4 h-4 inline mr-2"></i>
                    Как волонтер
                  </a>
                  <a href="/coordinator" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">
                    <i data-lucide="users" class="w-4 h-4 inline mr-2"></i>
                    Как координатор
                  </a>
                  <a href="/org/dashboard" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">
                    <i data-lucide="building" class="w-4 h-4 inline mr-2"></i>
                    Как организатор
                  </a>
                  <a href="/role-selector" class="block px-4 py-2 text-sm text-indigo-700 hover:bg-indigo-50 font-medium">
                    <i data-lucide="crown" class="w-4 h-4 inline mr-2"></i>
                    Выбор роли
                  </a>
                <% } %>
                
                <div class="border-t border-slate-200"></div>
                <a href="/logout" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Выйти</a>
              </div>
            </div>
          <% } else { %>
            <!-- Telegram Login Widget placeholder -->
            <div id="telegram-login-widget" class="hidden"></div>
            <div class="flex items-center space-x-2">
              <a href="/login" class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                Войти
              </a>
              <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs font-medium rounded-full">
                TG TODO
              </span>
            </div>
          <% } %>
        </div>

        <!-- Mobile menu button -->
        <div class="md:hidden">
          <button @click="mobileMenuOpen = !mobileMenuOpen" class="text-slate-600 hover:text-slate-900">
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <div x-show="mobileMenuOpen" x-transition class="md:hidden">
        <div class="px-2 pt-2 pb-3 space-y-1 border-t border-slate-200">
          <a href="/events" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-slate-900">События</a>
          <a href="/organizations" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-slate-900">Организации</a>
          <% if (it.user) { %>
            <a href="/account" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-slate-900">Личный кабинет</a>
            <% if (it.user?.roles?.includes('organizer') || it.user?.roles?.includes('coordinator')) { %>
              <a href="/org/dashboard" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-slate-900">Дашборд организации</a>
            <% } %>
            <a href="/logout" class="block px-3 py-2 text-base font-medium text-slate-600 hover:text-slate-900">Выйти</a>
          <% } else { %>
            <a href="/login" class="block px-3 py-2 text-base font-medium bg-emerald-500 text-white rounded-md">Войти</a>
          <% } %>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="flex-1">
    <%~ it.body %>
  </main>

  <!-- Footer -->
  <footer class="bg-slate-800 text-slate-300">
    <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div class="col-span-1 md:col-span-2">
          <div class="flex items-center space-x-2 mb-4">
            <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center">
              <i data-lucide="heart-handshake" class="w-5 h-5 text-white"></i>
            </div>
            <span class="text-xl font-bold text-white">KvadricepsHub</span>
          </div>
          <p class="text-slate-400 max-w-md">
            Платформа для объединения волонтёров и организаций. Находите возможности помочь или создавайте собственные мероприятия.
          </p>
        </div>
        <div>
          <h3 class="text-white font-semibold mb-4">Для волонтёров</h3>
          <ul class="space-y-2">
            <li><a href="/events" class="hover:text-white transition-colors">Найти события</a></li>
            <li><a href="/account" class="hover:text-white transition-colors">Мой профиль</a></li>
            <li><a href="/hours" class="hover:text-white transition-colors">Мои часы</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-white font-semibold mb-4">Для организаций</h3>
          <ul class="space-y-2">
            <li><a href="/org/register" class="hover:text-white transition-colors">Регистрация</a></li>
            <li><a href="/org/dashboard" class="hover:text-white transition-colors">Дашборд</a></li>
            <li><a href="/help" class="hover:text-white transition-colors">Помощь</a></li>
          </ul>
        </div>
      </div>
      <div class="mt-8 pt-8 border-t border-slate-700 text-center text-slate-400">
        <p>&copy; 2025 VolunteerHub. Все права защищены.</p>
      </div>
    </div>
  </footer>

  <!-- Toast notifications -->
  <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <script>
    // Initialize Lucide icons
    lucide.createIcons();
    
    // Toast notification system
      window.showToast = function(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `px-4 py-3 rounded-md shadow-lg transform translate-x-full transition-transform duration-300 ${
        type === 'success' ? 'bg-green-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        type === 'warning' ? 'bg-yellow-500 text-black' :
        'bg-blue-500 text-white'
      }`;
      toast.textContent = message;
      
      container.appendChild(toast);
      
      // Animate in
      setTimeout(() => toast.classList.remove('translate-x-full'), 100);
      
      // Auto remove
      setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => container.removeChild(toast), 300);
      }, 5000);
      };

      // Analytics helper
      const ANALYTICS_USER_ID = <%= JSON.stringify(it.user?.id ?? null) %>;
      window.trackEvent = function(eventType, eventData = {}) {
        fetch('/api/analytics', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            event_type: eventType,
            event_data: eventData,
            user_id: ANALYTICS_USER_ID,
          }),
        }).catch(err => console.error('Analytics error:', err));
      };

      // PWA installation
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
      deferredPrompt = e;
      // Show install button if needed
    });
  </script>
</body>
</html>
